require 'rubygems'
require 'right_aws'
require 'turbo'

control_queue = ARGV[0]

if control_queue.nil?
  puts "No queue name specified: exiting"
  exit
end

host = `hostname`

puts "#{host} monitoring #{control_queue}"

queue = Turbo::Queue.new(control_queue)
queue.send("Hello, friend!")

loop do
  
  puts "Checking queue"
  
  if queue.messages?
    for message in queue.messages
      puts "MESSAGE: #{message} (cleared)"
      message.clear
    end
  end
  
  sleep 5
end